function net_gobrechts_d3_force(e,t,n){"use strict";function i(e){r.tools.triggerApexEvent(document.querySelector("#"+r.conf.domContainerId),"apexbeforerefresh");if(r.conf.customize)r.tools.customizeChart();else d3.select("#"+r.conf.domContainerId+"_customizing").remove();if(!e&&!r.data.rawDataString){r.tools.logError("Houston, we have a problem - we have to provide sample data.");r.conf.sampleData=true;e=r.data.sampleData}else if(e){r.conf.sampleData=false}if(e){if(e.trim().substr(0,1)=="<"){try{r.data.rawDataString=r.tools.x2js.xml_str2json(e)}catch(t){r.tools.logError("Unable to convert XML string to JSON: "+t.message)+"."}}else if(e.trim().substr(0,1)=="{"){try{r.data.rawDataString=JSON.parse(e)}catch(t){r.tools.logError("Unable to parse JSON data string: "+t.message)+"."}}else{r.tools.logError('Your data is not starting with "<" or "{" - rendering of graph not possible - keeping the old data.')}r.tools.log("Raw data string:");r.tools.log(e,true);r.tools.log("Converted JSON object:");r.tools.log(r.data.rawDataString,true);r.data.links=r.data.rawDataString.data.links;r.data.nodes=r.data.rawDataString.data.nodes;r.data.id_lookup=[];r.data.nodes.forEach(function(e,t){e.SIZEVALUE=parseFloat(e.SIZEVALUE);e.index=t;e.LABELCIRCULAR=!!e.LABELCIRCULAR;r.data.id_lookup[e.ID]=e});r.data.links.forEach(function(e,t){e.source=r.data.id_lookup[e.FROMID];e.target=r.data.id_lookup[e.TOID]});r.data.links=r.data.links.filter(function(e){return typeof e.source!="undefined"&&typeof e.target!="undefined"});r.data.neighbors=r.data.links.map(function(e){return e.FROMID+":"+e.TOID})}r.conf.domSvg.classed("border",r.conf.showBorder);if(r.conf.colorScheme=="color20"){r.tools.color=d3.scale.category20()}else if(r.conf.colorScheme=="color20b"){r.tools.color=d3.scale.category20b()}else if(r.conf.colorScheme=="color20c"){r.tools.color=d3.scale.category20c()}else if(r.conf.colorScheme=="color10"){r.tools.color=d3.scale.category10()}else if(r.conf.colorScheme=="direct"){r.tools.color=function(e){return e}}else{r.conf.colorScheme="color20";r.tools.color=d3.scale.category20()}if(r.conf.positions){var n=0;r.conf.positions.forEach(function(e,t){if(r.data.id_lookup[e.ID]!==undefined){r.data.id_lookup[e.ID].x=e.x;r.data.id_lookup[e.ID].y=e.y;r.data.id_lookup[e.ID].px=e.x;r.data.id_lookup[e.ID].py=e.y;r.data.id_lookup[e.ID].fixed=e.fixed;if(e.fixed==1)n++}});if(n>0)r.conf.pinMode=true;r.conf.positions=null}else{r.conf.domSvg.selectAll("circle.node").data(r.data.nodes,function(e){return r.conf.domContainerId+"_"+e.ID}).each(function(e){r.data.id_lookup[e.ID].x=parseFloat(d3.select(this).attr("cx"));r.data.id_lookup[e.ID].y=parseFloat(d3.select(this).attr("cy"))})}r.tools.radius=d3.scale.sqrt().range([r.conf.minNodeRadius,r.conf.maxNodeRadius]).domain(d3.extent(r.data.nodes,function(e){return parseFloat(e.SIZEVALUE)}));r.data.nodes.forEach(function(e){e.radius=r.tools.radius(e.SIZEVALUE);if(!r.conf.pinMode&&e.fixed)e.fixed=false});r.links=r.conf.domSvg.selectAll("line.link").data(r.data.links.filter(function(e){return e.FROMID!=e.TOID}),function(e){return r.conf.domContainerId+"_link_"+e.FROMID+"_"+e.TOID}).style("marker-end",r.conf.showLinkDirection?"url(#"+r.conf.domContainerId+"_normalTriangle)":null).classed("dashed",function(e){return e.STYLE==="dashed"});r.links.enter().append("svg:line").attr("id",function(e){return r.conf.domContainerId+"_link_"+e.FROMID+"_"+e.TOID}).attr("class","link").style("marker-end",r.conf.showLinkDirection?"url(#"+r.conf.domContainerId+"_normalTriangle)":null).classed("dashed",function(e){return e.STYLE==="dashed"});r.links.exit().remove();r.selfLinks=r.conf.domSvg.selectAll("path.link").data(r.data.links.filter(function(e){return e.FROMID==e.TOID&&r.conf.showSelfLinks}),function(e){return r.conf.domContainerId+"_link_"+e.FROMID+"_"+e.TOID}).attr("d",function(e){return r.tools.getSelfLinkPath(e)}).style("marker-end",r.conf.showLinkDirection?"url(#"+r.conf.domContainerId+"_normalTriangle)":null).classed("dashed",function(e){return e.STYLE=="dashed"});r.selfLinks.enter().append("svg:path").attr("id",function(e){return r.conf.domContainerId+"_link_"+e.FROMID+"_"+e.TOID}).attr("class","link").attr("d",function(e){return r.tools.getSelfLinkPath(e)}).style("marker-end",r.conf.showLinkDirection?"url(#"+r.conf.domContainerId+"_normalTriangle)":null).classed("dashed",function(e){return e.STYLE=="dashed"});r.selfLinks.exit().remove();r.labels=r.conf.domSvg.selectAll("text.label").data(r.data.nodes.filter(function(e){return!e.LABELCIRCULAR&&!r.conf.labelsCircular}),function(e){return r.conf.domContainerId+"_label_"+e.ID}).text(function(e){return e.LABEL});r.labels.enter().append("svg:text").attr("id",function(e){return r.conf.domContainerId+"_label_"+e.ID}).attr("class","label").text(function(e){return e.LABEL});r.labels.exit().remove();r.labelPaths=r.conf.domSvgDefs.selectAll("path.label").data(r.data.nodes.filter(function(e){return e.LABELCIRCULAR||r.conf.labelsCircular}),function(e){return r.conf.domContainerId+"_textPath_"+e.ID}).attr("d",function(e){return r.tools.getLabelPath(e)});r.labelPaths.enter().append("svg:path").attr("id",function(e){return r.conf.domContainerId+"_textPath_"+e.ID}).attr("class","label").attr("d",function(e){return r.tools.getLabelPath(e)});r.labelPaths.exit().remove();r.labelsCircular=r.conf.domSvg.selectAll("text.labelCircular").data(r.data.nodes.filter(function(e){return e.LABELCIRCULAR||r.conf.labelsCircular}),function(e){return r.conf.domContainerId+"_labelCircular_"+e.ID}).each(function(e){d3.select("#"+r.conf.domContainerId+"_pathReference_"+e.ID).text(e.LABEL)});r.labelsCircular.enter().append("svg:text").attr("id",function(e){return r.conf.domContainerId+"_labelCircular_"+e.ID}).attr("class","labelCircular").append("svg:textPath").attr("id",function(e){return r.conf.domContainerId+"_pathReference_"+e.ID}).attr("xlink:href",function(e){return"#"+r.conf.domContainerId+"_textPath_"+e.ID}).text(function(e){return e.LABEL});r.labelsCircular.exit().remove();r.nodes=r.conf.domSvg.selectAll("circle.node").data(r.data.nodes,function(e){return r.conf.domContainerId+"_node_"+e.ID}).attr("r",function(e){return e.radius}).style("fill",null).style("fill",function(e){return r.tools.color(e.COLORVALUE)});r.nodes.enter().append("svg:circle").attr("id",function(e){return r.conf.domContainerId+"_node_"+e.ID}).attr("class","node").attr("r",function(e){return e.radius}).style("fill",function(e){return r.tools.color(e.COLORVALUE)}).on("mouseenter",r.tools.onNodeMouseenter).on("mouseleave",r.tools.onNodeMouseleave).on("click",r.tools.onNodeClick).on("dblclick",r.tools.onNodeDblclick).on("contextmenu",r.tools.onNodeContextmenu);r.nodes.exit().remove();if(!r.conf.customize&&(r.conf.debug||document.querySelector("#apex-dev-toolbar")!==null)){if(document.querySelector("#"+r.conf.domContainerId+" svg text.link")===null){r.conf.domSvg.append("svg:text").attr("class","link").attr("x",5).attr("y",15).attr("text-anchor","start").text("Customize Me").on("click",function(){r.conf.customize=true;i()})}}else{r.conf.domSvg.select("#"+r.conf.domContainerId+" svg .customize_me").remove()}if(r.conf.dragMode){r.nodes.call(r.drag)}else{r.nodes.on("mousedown.drag",null)}if(r.conf.pinMode&&r.conf.dragMode){r.drag.on("dragstart",function(e){d3.select(this).classed("fixed",e.fixed=true)})}else{r.drag.on("dragstart",null)}if(r.conf.useDomParentWidth){r.conf.domContainerWidth=r.tools.getSvgParentInnerWidth();d3.select(window).on("resize",function(){var e=r.conf.domContainerWidth;var t=r.tools.getSvgParentInnerWidth();if(e!==t){r.conf.domContainerWidth=t;i()}})}else{d3.select(window).on("resize",null)}r.conf.domSvg.attr("width",r.conf.useDomParentWidth?r.conf.domContainerWidth:r.conf.width).attr("height",r.conf.height);r.force.nodes(r.data.nodes).links(r.data.links).size([r.conf.useDomParentWidth?r.conf.domContainerWidth:r.conf.width,r.conf.height]).friction(r.conf.friction).charge(r.conf.charge).theta(r.conf.theta).gravity(r.conf.gravity).linkDistance(r.conf.linkDistance).linkStrength(r.conf.linkStrength).start();if(r.conf.autoRefresh&&r.conf.refreshInterval&&!r.conf.interval){r.conf.interval=window.setInterval(function(){i.start()},r.conf.refreshInterval);r.tools.log("Auto refresh started with an interval of "+r.conf.refreshInterval+" milliseconds.")}else if(r.conf.autoRefresh===false&&r.conf.interval){clearInterval(r.conf.interval);r.conf.interval=null;r.tools.log("Auto refresh stopped.")}r.tools.triggerApexEvent(document.querySelector("#"+r.conf.domContainerId),"apexafterrefresh")}var r={version:"1.0.0"};r.conf={};r.data={};r.tools={};r.conf.domContainerId=e||"d3Force"+Math.floor(Math.random()*1e6);r.confUser=t||{};r.conf.apexPluginId=n;r.conf.debugPrefix="D3 Force in DOM container #"+r.conf.domContainerId+": ";if(r.conf.apexPluginId&&apex.jQuery("#pdebug").length==1){r.conf.debug=true}else{r.conf.debug=false}r.tickCounter;r.startTime;r.confDefaults={showBorder:{type:"bool",val:true,link:"https://github.com/ogobrecht/d3-force-apex-plugin#showBorder"},showSelfLinks:{type:"bool",val:true,link:"https://github.com/ogobrecht/d3-force-apex-plugin#showSelfLinks"},showLinkDirection:{type:"bool",val:true,link:"https://github.com/ogobrecht/d3-force-apex-plugin#showLinkDirection"},showTooltips:{type:"bool",val:true,link:"https://github.com/ogobrecht/d3-force-apex-plugin#showTooltips"},tooltipPosition:{type:"select",val:"node",options:["node","svgTopLeft","svgTopRight"],link:"https://github.com/ogobrecht/d3-force-apex-plugin#tooltipPosition"},colorScheme:{type:"select",val:"color20",options:["color20","color20b","color20c","color10","direct"],link:"https://github.com/ogobrecht/d3-force-apex-plugin#colorScheme"},labelsCircular:{type:"bool",val:false,link:"https://github.com/ogobrecht/d3-force-apex-plugin#labelsCircular"},dragMode:{type:"bool",val:true,link:"https://github.com/ogobrecht/d3-force-apex-plugin#dragMode"},pinMode:{type:"bool",val:false,link:"https://github.com/ogobrecht/d3-force-apex-plugin#pinMode"},nodeEventToStopPinMode:{type:"select",val:"contextmenu",options:["none","dblclick","contextmenu"],link:"https://github.com/ogobrecht/d3-force-apex-plugin#nodeEventToStopPinMode"},onNodeContextmenuPreventDefault:{type:"bool",val:false,link:"https://github.com/ogobrecht/d3-force-apex-plugin#onNodeContextmenuPreventDefault"},nodeEventToOpenLink:{type:"select",val:"dblclick",options:["none","click","dblclick","contextmenu"],link:"https://github.com/ogobrecht/d3-force-apex-plugin#nodeEventToOpenLink"},nodeLinkTarget:{type:"text",val:"_blank",link:"https://github.com/ogobrecht/d3-force-apex-plugin#nodeLinkTarget"},autoRefresh:{type:"bool",val:false,link:"https://github.com/ogobrecht/d3-force-apex-plugin#autoRefresh"},refreshInterval:{type:"number",val:5e3,link:"https://github.com/ogobrecht/d3-force-apex-plugin#refreshInterval"},useDomParentWidth:{type:"bool",val:false,link:"https://github.com/ogobrecht/d3-force-apex-plugin#useDomParentWidth"},width:{type:"number",val:500,link:"https://github.com/ogobrecht/d3-force-apex-plugin#width"},height:{type:"number",val:500,link:"https://github.com/ogobrecht/d3-force-apex-plugin#height"},minNodeRadius:{type:"number",val:6,link:"https://github.com/ogobrecht/d3-force-apex-plugin#minNodeRadius"},maxNodeRadius:{type:"number",val:18,link:"https://github.com/ogobrecht/d3-force-apex-plugin#maxNodeRadius"},labelDistance:{type:"number",val:12,link:"https://github.com/ogobrecht/d3-force-apex-plugin#labelDistance"},selfLinkDistance:{type:"number",val:20,link:"https://github.com/ogobrecht/d3-force-apex-plugin#selfLinkDistance"},linkDistance:{type:"number",val:80,link:"https://github.com/ogobrecht/d3-force-apex-plugin#linkDistance"},charge:{type:"number",val:-350,internal:true,link:"https://github.com/ogobrecht/d3-force-apex-plugin#charge"},gravity:{type:"select",val:.1,options:["1.00","0.95","0.90","0.85","0.80","0.75","0.70","0.65","0.60","0.55","0.50","0.45","0.40","0.35","0.30","0.25","0.20","0.15","0.10","0.05","0.00"],internal:true,link:"https://github.com/ogobrecht/d3-force-apex-plugin#gravity"},linkStrength:{type:"select",val:1,options:["1.00","0.95","0.90","0.85","0.80","0.75","0.70","0.65","0.60","0.55","0.50","0.45","0.40","0.35","0.30","0.25","0.20","0.15","0.10","0.05","0.00"],internal:true,link:"https://github.com/ogobrecht/d3-force-apex-plugin#linkStrength"},friction:{type:"select",val:.9,options:["1.00","0.95","0.90","0.85","0.80","0.75","0.70","0.65","0.60","0.55","0.50","0.45","0.40","0.35","0.30","0.25","0.20","0.15","0.10","0.05","0.00"],internal:true,link:"https://github.com/ogobrecht/d3-force-apex-plugin#friction"},theta:{type:"select",val:.8,options:["1.00","0.95","0.90","0.85","0.80","0.75","0.70","0.65","0.60","0.55","0.50","0.45","0.40","0.35","0.30","0.25","0.20","0.15","0.10","0.05","0.00"],internal:true,link:"https://github.com/ogobrecht/d3-force-apex-plugin#theta"}};r.conf.customize=false;r.conf.debug=r.confUser.debug||false;r.conf.width=r.confUser.width||r.confDefaults.width.val;r.conf.height=r.confUser.height||r.confDefaults.height.val;r.conf.minNodeRadius=r.confUser.minNodeRadius||r.confDefaults.minNodeRadius.val;r.conf.maxNodeRadius=r.confUser.maxNodeRadius||r.confDefaults.maxNodeRadius.val;r.conf.linkDistance=r.confUser.linkDistance||r.confDefaults.linkDistance.val;r.conf.selfLinkDistance=r.confUser.selfLinkDistance||r.confDefaults.selfLinkDistance.val;r.conf.labelDistance=r.confUser.labelDistance||r.confDefaults.labelDistance.val;r.conf.colorScheme=r.confUser.colorScheme||r.confDefaults.colorScheme.val;r.conf.useDomParentWidth=r.confUser.useDomParentWidth||r.confDefaults.useDomParentWidth.val;r.conf.showBorder=r.confUser.showBorder||r.confDefaults.showBorder.val;r.conf.showSelfLinks=r.confUser.showSelfLinks||r.confDefaults.showSelfLinks.val;r.conf.showLinkDirection=r.confUser.showLinkDirection||r.confDefaults.showLinkDirection.val;r.conf.showTooltips=r.confUser.showTooltips||r.confDefaults.showTooltips.val;r.conf.tooltipPosition=r.confUser.tooltipPosition||r.confDefaults.tooltipPosition.val;r.conf.labelsCircular=r.confUser.labelsCircular||r.confDefaults.labelsCircular.val;r.conf.dragMode=r.confUser.dragMode||r.confDefaults.dragMode.val;r.conf.pinMode=r.confUser.pinMode||r.confDefaults.pinMode.val;r.conf.nodeEventToStopPinMode=r.confUser.nodeEventToStopPinMode||r.confDefaults.nodeEventToStopPinMode.val;r.conf.nodeEventToOpenLink=r.confUser.nodeEventToOpenLink||r.confDefaults.nodeEventToOpenLink.val;r.conf.onNodeMouseenterFunction=r.confUser.onNodeMouseenterFunction||null;r.conf.onNodeMouseleaveFunction=r.confUser.onNodeMouseleaveFunction||null;r.conf.onNodeClickFunction=r.confUser.onNodeClickFunction||null;r.conf.onNodeDblclickFunction=r.confUser.onNodeDblclickFunction||null;r.conf.onNodeContextmenuFunction=r.confUser.onNodeContextmenuFunction||null;r.conf.onNodeContextmenuPreventDefault=r.confUser.onNodeContextmenuPreventDefault||r.confDefaults.onNodeContextmenuPreventDefault.val;r.conf.autoRefresh=r.confUser.autoRefresh||r.confDefaults.autoRefresh.val;r.conf.refreshInterval=r.confUser.refreshInterval||r.confDefaults.refreshInterval.val;r.conf.nodeLinkTarget=r.confUser.nodeLinkTarget||r.confDefaults.nodeLinkTarget.val;r.conf.charge=r.confUser.charge||r.confDefaults.charge.val;r.conf.chargeDistance=r.confUser.chargeDistance||null;r.conf.linkStrength=r.confUser.linkStrength||r.confDefaults.linkStrength.val;r.conf.friction=r.confUser.friction||r.confDefaults.friction.val;r.conf.theta=r.confUser.theta||r.confDefaults.theta.val;r.conf.gravity=r.confUser.gravity||r.confDefaults.gravity.val;r.conf.currentTabPosition=null;r.conf.sampleData=false;r.data.sampleData="<data>"+'<nodes ID="7839" LABEL="KING is THE KING, you know?" COLORVALUE="10" SIZEVALUE="5000" LABELCIRCULAR="true" LINK="http://apex.oracle.com/"'+' INFOSTRING="This visualization is based on the well known emp table." />'+'<nodes ID="7698" LABEL="BLAKE" COLORVALUE="30" SIZEVALUE="2850"/>'+'<nodes ID="7782" LABEL="CLARK" COLORVALUE="10" SIZEVALUE="2450"/>'+'<nodes ID="7566" LABEL="JONES" COLORVALUE="20" SIZEVALUE="2975"/>'+'<nodes ID="7788" LABEL="SCOTT" COLORVALUE="20" SIZEVALUE="3000"/>'+'<nodes ID="7902" LABEL="FORD" COLORVALUE="20" SIZEVALUE="3000"/>'+'<nodes ID="7369" LABEL="SMITH" COLORVALUE="20" SIZEVALUE="800"/>'+'<nodes ID="7499" LABEL="ALLEN" COLORVALUE="30" SIZEVALUE="1600"/>'+'<nodes ID="7521" LABEL="WARD" COLORVALUE="30" SIZEVALUE="1250"/>'+'<nodes ID="7654" LABEL="MARTIN" COLORVALUE="30" SIZEVALUE="1250"/>'+'<nodes ID="7844" LABEL="TURNER" COLORVALUE="30" SIZEVALUE="1500"/>'+'<nodes ID="7876" LABEL="ADAMS" COLORVALUE="20" SIZEVALUE="1100"/>'+'<nodes ID="7900" LABEL="JAMES" COLORVALUE="30" SIZEVALUE="950"/>'+'<nodes ID="7934" LABEL="MILLER" COLORVALUE="10" SIZEVALUE="1300"/>'+'<nodes ID="8888" LABEL="Who am I?" COLORVALUE="green" SIZEVALUE="2000" INFOSTRING="This is a good question. Think about it." />'+'<nodes ID="9999" LABEL="Where I am?" COLORVALUE="#f00" SIZEVALUE="1000" INFOSTRING="This is a good question. What do you think?" />'+'<links FROMID="7839" TOID="7839" STYLE="dashed"/>'+'<links FROMID="7698" TOID="7839" STYLE="solid"/>'+'<links FROMID="7782" TOID="7839" STYLE="solid"/>'+'<links FROMID="7566" TOID="7839" STYLE="solid"/>'+'<links FROMID="7788" TOID="7566" STYLE="solid"/>'+'<links FROMID="7902" TOID="7566" STYLE="solid"/>'+'<links FROMID="7369" TOID="7902" STYLE="solid"/>'+'<links FROMID="7499" TOID="7698" STYLE="solid"/>'+'<links FROMID="7521" TOID="7698" STYLE="solid"/>'+'<links FROMID="7654" TOID="7698" STYLE="solid"/>'+'<links FROMID="7844" TOID="7698" STYLE="solid"/>'+'<links FROMID="7876" TOID="7788" STYLE="solid"/>'+'<links FROMID="7900" TOID="7698" STYLE="solid"/>'+'<links FROMID="7934" TOID="7782" STYLE="solid"/>'+"</data>";if(document.querySelector("#"+r.conf.domContainerId)===null){r.conf.domContainer=d3.select("body").append("div").attr("id",r.conf.domContainerId)}else{r.conf.domContainer=d3.select("#"+r.conf.domContainerId);d3.selectAll("#"+r.conf.domContainerId+"_tooltip, #"+r.conf.domContainerId+"_customizing").remove()}if(document.querySelector("#"+r.conf.domContainerId+" svg")===null){r.conf.domSvg=r.conf.domContainer.append("svg")}else{r.conf.domSvg=d3.select("#"+r.conf.domContainerId+" svg");d3.select("#"+r.conf.domContainerId+" svg defs").remove()}r.conf.domSvg.attr("id",r.conf.domContainerId+"_svg").attr("class","net_gobrechts_d3_force").classed("border",r.conf.showBorder).attr("width",r.conf.width).attr("height",r.conf.height);r.conf.domSvgDefs=r.conf.domSvg.append("defs");r.conf.domSvgDefs.append("svg:marker").attr("id",r.conf.domContainerId+"_highlightedTriangle").attr("class","highlighted").attr("viewBox","0 0 10 10").attr("refX",10).attr("refY",5).attr("markerWidth",5).attr("markerHeight",5).attr("orient","auto").attr("markerUnits","strokeWidth").append("svg:path").attr("d","M0,0 L10,5 L0,10");r.conf.domSvgDefs.append("svg:marker").attr("id",r.conf.domContainerId+"_normalTriangle").attr("class","normal").attr("viewBox","0 0 10 10").attr("refX",10).attr("refY",5).attr("markerWidth",5).attr("markerHeight",5).attr("orient","auto").attr("markerUnits","strokeWidth").append("svg:path").attr("d","M0,0 L10,5 L0,10");r.conf.domTooltip=r.conf.domContainer.append("div").attr("id",r.conf.domContainerId+"_tooltip").attr("class","net_gobrechts_d3_force_tooltip").style("top","0px").style("left","0px");r.tools.log=function(e,t){if(r.conf.debug){if(t)console.log(e);else console.log(r.conf.debugPrefix+e)}if(r.conf.customize)r.conf.domCustomizeLog.text(e+"\n"+r.conf.domCustomizeLog.text())};r.tools.logError=function(e,t){console.log(r.conf.debugPrefix+"ERROR: "+e);if(r.conf.customize)r.conf.domCustomizeLog.text("ERROR: "+e+"\n"+r.conf.domCustomizeLog.text())};r.tools.triggerApexEvent=function(e,t,n){if(r.conf.apexPluginId)apex.event.trigger(e,t,n)};r.tools.neighboring=function(e,t){return r.data.neighbors.indexOf(e.ID+":"+t.ID)>-1||r.data.neighbors.indexOf(t.ID+":"+e.ID)>-1};r.tools.adjustSourceX=function(e){return e.source.x+Math.cos(r.tools.calcAngle(e))*e.source.radius};r.tools.adjustSourceY=function(e){return e.source.y+Math.sin(r.tools.calcAngle(e))*e.source.radius};r.tools.adjustTargetX=function(e){return e.target.x-Math.cos(r.tools.calcAngle(e))*e.target.radius};r.tools.adjustTargetY=function(e){return e.target.y-Math.sin(r.tools.calcAngle(e))*e.target.radius};r.tools.calcAngle=function(e){return Math.atan2(e.target.y-e.source.y,e.target.x-e.source.x)};r.tools.getSelfLinkPath=function(e){var t=e.source.radius;var n=e.source.radius+r.conf.selfLinkDistance;var i=0;var s=0;var o={source:{x:0,y:0,radius:t},target:{x:i+n/2,y:s+n,radius:t}};var u={source:{x:i-n/2,y:s+n,radius:t},target:{x:i,y:s,radius:t}};var a="M"+r.tools.adjustSourceX(o)+","+r.tools.adjustSourceY(o);a+=" L"+(i+n/2)+","+(s+n);a+=" A"+n+","+n+" 0 0,1 "+(i-n/2)+","+(s+n);a+=" L"+r.tools.adjustTargetX(u)+","+r.tools.adjustTargetY(u);return a};r.tools.getLabelPath=function(e){var t=e.radius+r.conf.labelDistance;var n=0;var i=0;var s="M"+(n-t)+","+i;s+=" a"+t+","+t+" 0 0,1 "+t*2+",0";s+=" a"+t+","+t+" 0 0,1 -"+t*2+",0";return s};r.tools.openLink=function(e){var t=window.open(e.LINK,r.conf.nodeLinkTarget);t.focus()};r.tools.onNodeMouseenter=function(e){var t;r.nodes.classed("highlighted",function(t){return r.tools.neighboring(t,e)});r.links.classed("highlighted",function(t){return t.source.ID==e.ID||t.target.ID==e.ID}).style("marker-end",function(t){if(r.conf.showLinkDirection){return"url(#"+r.conf.domContainerId+"_"+(t.source.ID==e.ID||t.target.ID==e.ID?"highlighted":"normal")+"Triangle)"}else{return null}});r.selfLinks.classed("highlighted",function(t){return t.FROMID==e.ID}).style("marker-end",function(t){if(r.conf.showLinkDirection){return"url(#"+r.conf.domContainerId+"_"+(t.source.ID==e.ID||t.target.ID==e.ID?"highlighted":"normal")+"Triangle)"}else{return null}});d3.select(this).classed("highlighted",true);r.tools.log("Event mouseenter triggered.");r.tools.triggerApexEvent(this,"net_gobrechts_d3_force_mouseenter",e);if(typeof r.conf.onNodeMouseenterFunction=="function")r.conf.onNodeMouseenterFunction.call(this,d3.event,e);if(r.conf.showTooltips&&e.INFOSTRING){r.conf.domTooltip.html(e.INFOSTRING).style("display","block");if(r.conf.tooltipPosition==="svgTopLeft"){t=r.tools.getOffsetRect(document.querySelector("#"+r.conf.domContainerId+" svg"));r.conf.domTooltip.style("top",t.top+(r.conf.domSvg.style("border-width")?parseInt(r.conf.domSvg.style("border-width")):1)+"px").style("left",t.left+(r.conf.domSvg.style("border-width")?parseInt(r.conf.domSvg.style("border-width")):1)+"px")}else if(r.conf.tooltipPosition==="svgTopRight"){t=r.tools.getOffsetRect(document.querySelector("#"+r.conf.domContainerId+" svg"));r.conf.domTooltip.style("top",t.top+parseInt(r.conf.domSvg.style("border-width")?parseInt(r.conf.domSvg.style("border-width")):1)+"px").style("left",t.left+parseInt(r.conf.domSvg.style("width"))+parseInt(r.conf.domSvg.style("border-width")?parseInt(r.conf.domSvg.style("border-width")):1)-parseInt(r.conf.domTooltip.style("width"))-2*parseInt(r.conf.domTooltip.style("border-width")?parseInt(r.conf.domTooltip.style("border-width")):0)-parseInt(r.conf.domTooltip.style("padding-left"))-parseInt(r.conf.domTooltip.style("padding-right"))+"px")}else{r.conf.domTooltip.style("left",d3.event.pageX+"px").style("top",d3.event.pageY+"px")}}};r.tools.onNodeMouseleave=function(e){r.nodes.classed("highlighted",false);r.links.classed("highlighted",false).style("marker-end",r.conf.showLinkDirection?"url(#"+r.conf.domContainerId+"_normalTriangle)":null);r.selfLinks.classed("highlighted",false).style("marker-end",r.conf.showLinkDirection?"url(#"+r.conf.domContainerId+"_normalTriangle)":null);r.labels.classed("highlighted",false);r.tools.log("Event mouseleave triggered.");r.tools.triggerApexEvent(this,"net_gobrechts_d3_force_mouseleave",e);if(typeof r.conf.onNodeMouseleaveFunction=="function")r.conf.onNodeMouseleaveFunction.call(this,d3.event,e);if(r.conf.showTooltips)r.conf.domTooltip.style("display","none")};r.tools.onNodeClick=function(e){if(e.LINK&&r.conf.nodeEventToOpenLink=="click")r.tools.openLink(e);if(r.conf.pinMode&&r.conf.nodeEventToStopPinMode=="click")d3.select(this).classed("fixed",e.fixed=false);r.tools.log("Event click triggered.");r.tools.triggerApexEvent(this,"net_gobrechts_d3_force_click",e);if(typeof r.conf.onNodeClickFunction=="function")r.conf.onNodeClickFunction.call(this,d3.event,e)};r.tools.onNodeDblclick=function(e){if(e.LINK&&r.conf.nodeEventToOpenLink=="dblclick")r.tools.openLink(e);if(r.conf.pinMode&&r.conf.nodeEventToStopPinMode=="dblclick")d3.select(this).classed("fixed",e.fixed=false);r.tools.log("Event dblclick triggered.");r.tools.triggerApexEvent(this,"net_gobrechts_d3_force_dblclick",e);if(typeof r.conf.onNodeDblclickFunction=="function")r.conf.onNodeDblclickFunction.call(this,d3.event,e)};r.tools.onNodeContextmenu=function(e){if(r.conf.onNodeContextmenuPreventDefault)d3.event.preventDefault();if(e.LINK&&r.conf.nodeEventToOpenLink=="contextmenu")r.tools.openLink(e);if(r.conf.pinMode&&r.conf.nodeEventToStopPinMode=="contextmenu")d3.select(this).classed("fixed",e.fixed=false);r.tools.log("Event contextmenu triggered.");r.tools.triggerApexEvent(this,"net_gobrechts_d3_force_contextmenu",e);if(typeof r.conf.onNodeContextmenuFunction=="function")r.conf.onNodeContextmenuFunction.call(this,d3.event,e)};r.tools.x2js=new X2JS({attributePrefix:"none"});r.tools.getSvgParentInnerWidth=function(){var e=d3.select(r.conf.domSvg.node().parentNode);return parseInt(e.style("width"))-parseInt(e.style("padding-left"))-parseInt(e.style("padding-right"))-(r.conf.domSvg.style("border-width")?parseInt(r.conf.domSvg.style("border-width")):1)*2};r.tools.getOffsetRect=function(e){var t=e.getBoundingClientRect();var n=document.body;var r=document.documentElement;var i=window.pageYOffset||r.scrollTop||n.scrollTop;var s=window.pageXOffset||r.scrollLeft||n.scrollLeft;var o=r.clientTop||n.clientTop||0;var u=r.clientLeft||n.clientLeft||0;var a=t.top+i-o;var f=t.left+s-u;return{top:Math.round(a),left:Math.round(f)}};r.tools.customizeDrag=d3.behavior.drag().on("dragstart",function(){var e=d3.mouse(document.body);r.conf.domCustomizePosition=r.tools.getOffsetRect(document.querySelector("#"+r.conf.domContainerId+"_customizing"));r.conf.domCustomizePosition.mouseLeft=e[0]-r.conf.domCustomizePosition.left;r.conf.domCustomizePosition.mouseTop=e[1]-r.conf.domCustomizePosition.top}).on("drag",function(){var e=d3.mouse(document.body);r.conf.domCustomize.style("left",Math.max(0,e[0]-r.conf.domCustomizePosition.mouseLeft)+"px").style("top",Math.max(0,e[1]-r.conf.domCustomizePosition.mouseTop)+"px")}).on("dragend",function(){r.conf.domCustomizePosition=r.tools.getOffsetRect(r.conf.domCustomize.node())});r.tools.customizeChart=function(){var e,t,n,s,o,u=0,a;if(!r.conf.domCustomizePosition){r.conf.domCustomizePosition=r.tools.getOffsetRect(r.conf.domSvg.node());r.conf.domCustomizePosition.left=r.conf.domCustomizePosition.left+r.conf.width+8;r.conf.domCustomizePosition.top=r.conf.domCustomizePosition.top}if(document.querySelector("#"+r.conf.domContainerId+"_customizing")!==null){r.conf.domCustomize.remove()}r.conf.domCustomize=r.conf.domContainer.append("div").attr("id",r.conf.domContainerId+"_customizing").attr("class","net_gobrechts_d3_force_customize").style("left",r.conf.domCustomizePosition.left+"px").style("top",r.conf.domCustomizePosition.top+"px");r.conf.domCustomize.append("span").attr("class","drag").call(r.tools.customizeDrag).append("span").attr("class","title").text('Customize "'+r.conf.domContainerId+'"');r.conf.domCustomize.append("a").attr("class","close").attr("tabindex",1).text("Close").on("click",function(){r.conf.customize=false;i()}).on("keydown",function(){if(d3.event.keyCode==13){r.conf.customize=false;i()}});e=r.conf.domCustomize.append("table");for(var f in r.confDefaults){if(r.confDefaults.hasOwnProperty(f)){u+=1;t=e.append("tr");t.append("td").attr("class","label").attr("tabindex",u+100).html('<a href="https://github.com/ogobrecht/d3-force-apex-plugin#'+f+'" target="github_d3_force">'+f+"</a>");if(r.confDefaults[f].type=="bool"){n=t.append("td").classed("warning",r.confDefaults[f].internal);s=n.append("input").attr("id",r.conf.domContainerId+"_"+f).attr("type","checkbox").attr("name",f).attr("tabindex",u+1).on("change",function(){r.conf.currentTabPosition=this.id;r.conf[this.name]=this.checked?true:false;r.tools.createCustomizingConfObject();i()});if(r.conf[f]===true){s.attr("checked","checked")}}else if(r.confDefaults[f].type=="text"||r.confDefaults[f].type=="number"){n=t.append("td").classed("warning",r.confDefaults[f].internal);s=n.append("input").attr("id",r.conf.domContainerId+"_"+f).attr("type","text").attr("name",f).attr("value",r.conf[f]).style("width","80px").attr("tabindex",u+1).on("change",function(){r.conf.currentTabPosition=this.id;if(r.confDefaults[this.name].type=="text"){r.conf[this.name]=this.value}else if(r.confDefaults[this.name].type=="number"){r.conf[this.name]=isNaN(parseFloat(this.value))?r.conf[this.name]:parseFloat(this.value)}r.tools.createCustomizingConfObject();i()})}else if(r.confDefaults[f].type=="select"){n=t.append("td").classed("warning",r.confDefaults[f].internal);s=n.append("select").attr("id",r.conf.domContainerId+"_"+f).attr("name",f).attr("value",r.conf[f]).attr("tabindex",u+1).on("change",function(){r.conf.currentTabPosition=this.id;r.conf[this.name]=this.options[this.selectedIndex].value;r.tools.createCustomizingConfObject();i()});r.confDefaults[f].options.forEach(function(e){o=e;s.append("option").attr("value",e).attr("selected",function(){return o==r.conf[f]?"selected":null}).text(e)})}if(u==1){a=t.append("td").style("vertical-align","top").style("padding-left","5px")}}}a.attr("rowspan",u).html('Your Configuration Object<br><textarea id="'+r.conf.domContainerId+'_conf_object" tabindex="'+(u+2)+'" readonly></textarea><br><br>'+"Current Positions<br>"+'<textarea id="'+r.conf.domContainerId+'_positions" tabindex="'+(u+3)+'" readonly>Force started - wait for end event to show positions...</textarea><br><br>'+"Log<br>"+'<textarea id="'+r.conf.domContainerId+'_log" tabindex="'+(u+4)+'" readonly></textarea><br><br>'+"Copyrights<br><br>"+'<a href="https://github.com/ogobrecht/d3-force-apex-plugin" target="github_d3_force" tabindex="'+(u+5)+'">D3 Force APEX Plugin</a> ('+r.version+")<br>"+"Ottmar Gobrecht<br><br>"+'<a href="http://d3js.org" target="d3js_org" tabindex="'+(u+6)+'">D3.js</a> ('+d3.version+")<br>"+"Mike Bostock<br><br>"+'<a href="https://code.google.com/p/x2js/" target="code_google_com" tabindex="'+(u+7)+'">X2JS</a> ('+r.tools.x2js.getVersion()+" modified)<br>"+"Abdulla Abdurakhmanov<br><br>");r.conf.domCustomizeConfObject=d3.select("#"+r.conf.domContainerId+"_conf_object");r.conf.domCustomizePositions=d3.select("#"+r.conf.domContainerId+"_positions");r.conf.domCustomizeLog=d3.select("#"+r.conf.domContainerId+"_log");r.tools.createCustomizingConfObject();if(r.conf.currentTabPosition)document.getElementById(r.conf.currentTabPosition).focus();else document.querySelector("#"+r.conf.domContainerId+"_customizing input").focus()};r.tools.createCustomizingConfObject=function(){var e="{\n";for(var t in r.confDefaults){if(r.confDefaults.hasOwnProperty(t)){if(r.confDefaults[t].type=="range"||r.confDefaults[t].type=="number"||r.confDefaults[t].type=="bool"){e+='"'+t+'":'+r.conf[t]+",\n"}else{e+='"'+t+'":"'+r.conf[t]+'",\n'}}}e=e.substr(0,e.length-2)+"\n}";r.conf.domCustomizeConfObject.text(e)};r.force=d3.layout.force().on("start",function(){r.tools.log("Force started.");if(r.conf.customize)r.conf.domCustomizePositions.text("Force started - wait for end event to show positions...");r.tickCounter=0;r.startTime=(new Date).getTime()}).on("tick",function(){r.selfLinks.attr("transform",function(e){return"translate("+e.source.x+","+e.source.y+")"});r.links.attr("x1",function(e){return r.tools.adjustSourceX(e)}).attr("y1",function(e){return r.tools.adjustSourceY(e)}).attr("x2",function(e){return r.tools.adjustTargetX(e)}).attr("y2",function(e){return r.tools.adjustTargetY(e)});r.labels.attr("x",function(e){return e.x}).attr("y",function(e){return e.y-e.radius-r.conf.labelDistance});r.labelPaths.attr("transform",function(e){return"translate("+e.x+","+e.y+")"});r.nodes.attr("cx",function(e){return e.x}).attr("cy",function(e){return e.y});r.tickCounter+=1}).on("end",function(){var e=(new Date).getTime()-r.startTime;var t=(e/1e3).toFixed(1);var n=Math.round(r.tickCounter/(e/1e3));var s=Math.round(e/r.tickCounter);if(r.conf.customize)r.conf.domCustomizePositions.text(i.positions());r.tools.log("Force ended.");r.tools.log(t+" seconds, "+r.tickCounter+" ticks to cool down. ("+n+" ticks/s, "+s+" ms/tick).")});r.drag=r.force.drag();i.start=function(e){if(e){i(e)}else if(r.conf.apexPluginId){apex.server.plugin(r.conf.apexPluginId,{},{success:function(e){if(e.trim()!="no_data_found"){i(e)}else{i()}},error:function(){r.tools.logError("Unable to load new data - AJAX call terminated with errors.")},dataType:"text"})}else{i()}return i};i.showBorder=function(e){if(!arguments.length)return r.conf.showBorder;r.conf.showBorder=e;return i};i.showSelfLinks=function(e){if(!arguments.length)return r.conf.showSelfLinks;r.conf.showSelfLinks=e;return i};i.showLinkDirection=function(e){if(!arguments.length)return r.conf.showLinkDirection;r.conf.showLinkDirection=e;return i};i.showTooltips=function(e){if(!arguments.length)return r.conf.showTooltips;r.conf.showTooltips=e;return i};i.tooltipPosition=function(e){if(!arguments.length)return r.conf.tooltipPosition;r.conf.tooltipPosition=e;return i};i.colorScheme=function(e){if(!arguments.length)return r.conf.colorScheme;r.conf.colorScheme=e;return i};i.labelsCircular=function(e){if(!arguments.length)return r.conf.labelsCircular;r.conf.labelsCircular=e;return i};i.dragMode=function(e){if(!arguments.length)return r.conf.dragMode;r.conf.dragMode=e;return i};i.pinMode=function(e){if(!arguments.length)return r.conf.pinMode;r.conf.pinMode=e;return i};i.nodeEventToStopPinMode=function(e){if(!arguments.length)return r.conf.nodeEventToStopPinMode;r.conf.nodeEventToStopPinMode=e;return i};i.onNodeContextmenuPreventDefault=function(e){if(!arguments.length)return r.conf.onNodeContextmenuPreventDefault;r.conf.onNodeContextmenuPreventDefault=e;return i};i.nodeEventToOpenLink=function(e){if(!arguments.length)return r.conf.nodeEventToOpenLink;r.conf.nodeEventToOpenLink=e;return i};i.nodeLinkTarget=function(e){if(!arguments.length)return r.conf.nodeLinkTarget;r.conf.nodeLinkTarget=e;return i};i.autoRefresh=function(e){if(!arguments.length)return r.conf.autoRefresh;r.conf.autoRefresh=e;return i};i.refreshInterval=function(e){if(!arguments.length)return r.conf.refreshInterval;r.conf.refreshInterval=e;return i};i.useDomParentWidth=function(e){if(!arguments.length)return r.conf.useDomParentWidth;r.conf.useDomParentWidth=e;return i};i.width=function(e){if(!arguments.length)return r.conf.width;r.conf.width=e;return i};i.height=function(e){if(!arguments.length)return r.conf.height;r.conf.height=e;return i};i.minNodeRadius=function(e){if(!arguments.length)return r.conf.minNodeRadius;r.conf.minNodeRadius=e;return i};i.maxNodeRadius=function(e){if(!arguments.length)return r.conf.maxNodeRadius;r.conf.maxNodeRadius=e;return i};i.labelDistance=function(e){if(!arguments.length)return r.conf.labelDistance;r.conf.labelDistance=e;return i};i.selfLinkDistance=function(e){if(!arguments.length)return r.conf.selfLinkDistance;r.conf.selfLinkDistance=e;return i};i.linkDistance=function(e){if(!arguments.length)return r.conf.linkDistance;r.conf.linkDistance=e;return i};i.charge=function(e){if(!arguments.length)return r.conf.charge;r.conf.charge=e;return i};i.gravity=function(e){if(!arguments.length)return r.conf.gravity;r.conf.gravity=e;return i};i.chargeDistance=function(e){if(!arguments.length)return r.conf.chargeDistance;r.conf.chargeDistance=e;return i};i.linkStrength=function(e){if(!arguments.length)return r.conf.linkStrength;r.conf.linkStrength=e;return i};i.friction=function(e){if(!arguments.length)return r.conf.friction;r.conf.friction=e;return i};i.theta=function(e){if(!arguments.length)return r.conf.theta;r.conf.theta=e;return i};i.positions=function(e){if(!arguments.length){var t="[\n";r.data.nodes.forEach(function(e){t+='{"ID":"'+e.ID+'","x":'+e.x+',"y":'+e.y+',"fixed":'+(e.fixed?1:0)+"},\n"});return t.substr(0,t.length-2)+"\n]"}else{r.conf.positions=e;return i}};i.onNodeMouseenterFunction=function(e){if(!arguments.length)return r.conf.onNodeMouseenterFunction;r.conf.onNodeMouseenterFunction=e;return i};i.onNodeMouseleaveFunction=function(e){if(!arguments.length)return r.conf.onNodeMouseleaveFunction;r.conf.onNodeMouseleaveFunction=e;return i};i.onNodeClickFunction=function(e){if(!arguments.length)return r.conf.onNodeClickFunction;r.conf.onNodeClickFunction=e;return i};i.onNodeDblclickFunction=function(e){if(!arguments.length)return r.conf.onNodeDblclickFunction;r.conf.onNodeDblclickFunction=e;return i};i.onNodeContextmenuFunction=function(e){if(!arguments.length)return r.conf.onNodeContextmenuFunction;r.conf.onNodeContextmenuFunction=e;return i};i.currentTabPosition=function(e){if(!arguments.length)return r.conf.currentTabPosition;r.conf.currentTabPosition=e;return i};i.sampleData=function(e){if(!arguments.length)return r.data.sampleData;r.data.sampleData=e;return i};i.customize=function(e){if(!arguments.length)return r.conf.customize;r.conf.customize=e;return i};i.debug=function(e){if(!arguments.length)return r.conf.debug;r.conf.debug=e;return i};i.inspect=function(){return r};i.version=function(){return r.version};if(r.conf.apexPluginId){apex.jQuery("#"+r.conf.domContainerId).bind("apexrefresh",function(){i.start()})}return i}