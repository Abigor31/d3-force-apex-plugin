function net_gobrechts_d3_force(e,t,n,r){"use strict";function s(e){i.tools.triggerApexEvent(document.querySelector("#"+i.conf.domContainerId),"apexbeforerefresh");if(i.conf.customize)i.tools.customizeChart();else d3.select("#"+i.conf.domContainerId+"_customizing").remove();if(!e&&!i.data.rawDataString){i.tools.logError("Houston, we have a problem - we have to provide sample data.");i.conf.sampleData=true;e=i.data.sampleData}else if(e){i.conf.sampleData=false}if(e){if(e.trim().substr(0,1)=="<"){try{i.data.rawDataString=i.tools.x2js.xml_str2json(e)}catch(t){i.tools.logError("Unable to convert XML string to JSON: "+t.message)+"."}}else if(e.trim().substr(0,1)=="{"){try{i.data.rawDataString=JSON.parse(e)}catch(t){i.tools.logError("Unable to parse JSON data string: "+t.message)+"."}}else{i.tools.logError('Your data is not starting with "<" or "{" - rendering of graph not possible - keeping the old data.')}i.tools.log("Raw data string:");i.tools.log(e,true);i.tools.log("Converted JSON object:");i.tools.log(i.data.rawDataString,true);i.data.links=i.data.rawDataString.data.links;i.data.nodes=i.data.rawDataString.data.nodes;i.data.id_lookup=[];i.data.nodes.forEach(function(e,t){e.SIZEVALUE=parseFloat(e.SIZEVALUE);e.index=t;e.LABELCIRCULAR=!!e.LABELCIRCULAR;i.data.id_lookup[e.ID]=e});i.data.links.forEach(function(e,t){e.source=i.data.id_lookup[e.FROMID];e.target=i.data.id_lookup[e.TOID]});i.data.links=i.data.links.filter(function(e){return typeof e.source!="undefined"&&typeof e.target!="undefined"});i.data.neighbors=i.data.links.map(function(e){return e.FROMID+":"+e.TOID})}i.conf.domSvg.classed("border",i.conf.showBorder);if(i.conf.colorScheme=="color20"){i.tools.color=d3.scale.category20()}else if(i.conf.colorScheme=="color20b"){i.tools.color=d3.scale.category20b()}else if(i.conf.colorScheme=="color20c"){i.tools.color=d3.scale.category20c()}else if(i.conf.colorScheme=="color10"){i.tools.color=d3.scale.category10()}else if(i.conf.colorScheme=="direct"){i.tools.color=function(e){return e}}else{i.conf.colorScheme="color20";i.tools.color=d3.scale.category20()}if(i.conf.positions){var n=0;i.conf.positions.forEach(function(e,t){if(i.data.id_lookup[e.ID]!==undefined){i.data.id_lookup[e.ID].x=e.x;i.data.id_lookup[e.ID].y=e.y;i.data.id_lookup[e.ID].px=e.x;i.data.id_lookup[e.ID].py=e.y;i.data.id_lookup[e.ID].fixed=e.fixed;if(e.fixed==1)n++}});if(n>0)i.conf.pinMode=true;i.conf.positions=null}else{i.conf.domSvg.selectAll("circle.node").data(i.data.nodes,function(e){return i.conf.domContainerId+"_"+e.ID}).each(function(e){i.data.id_lookup[e.ID].x=parseFloat(d3.select(this).attr("cx"));i.data.id_lookup[e.ID].y=parseFloat(d3.select(this).attr("cy"))})}i.tools.radius=d3.scale.sqrt().range([i.conf.minNodeRadius,i.conf.maxNodeRadius]).domain(d3.extent(i.data.nodes,function(e){return parseFloat(e.SIZEVALUE)}));i.data.nodes.forEach(function(e){e.radius=i.tools.radius(e.SIZEVALUE);if(!i.conf.pinMode&&e.fixed)e.fixed=false});i.links=i.conf.domSvg.selectAll("line.link").data(i.data.links.filter(function(e){return e.FROMID!=e.TOID}),function(e){return i.conf.domContainerId+"_link_"+e.FROMID+"_"+e.TOID}).style("marker-end",i.conf.showLinkDirection?"url(#"+i.conf.domContainerId+"_normalTriangle)":null).classed("dashed",function(e){return e.STYLE==="dashed"});i.links.enter().append("svg:line").attr("id",function(e){return i.conf.domContainerId+"_link_"+e.FROMID+"_"+e.TOID}).attr("class","link").style("marker-end",i.conf.showLinkDirection?"url(#"+i.conf.domContainerId+"_normalTriangle)":null).classed("dashed",function(e){return e.STYLE==="dashed"});i.links.exit().remove();i.selfLinks=i.conf.domSvg.selectAll("path.link").data(i.data.links.filter(function(e){return e.FROMID==e.TOID&&i.conf.showSelfLinks}),function(e){return i.conf.domContainerId+"_link_"+e.FROMID+"_"+e.TOID}).attr("d",function(e){return i.tools.getSelfLinkPath(e)}).style("marker-end",i.conf.showLinkDirection?"url(#"+i.conf.domContainerId+"_normalTriangle)":null).classed("dashed",function(e){return e.STYLE=="dashed"});i.selfLinks.enter().append("svg:path").attr("id",function(e){return i.conf.domContainerId+"_link_"+e.FROMID+"_"+e.TOID}).attr("class","link").attr("d",function(e){return i.tools.getSelfLinkPath(e)}).style("marker-end",i.conf.showLinkDirection?"url(#"+i.conf.domContainerId+"_normalTriangle)":null).classed("dashed",function(e){return e.STYLE=="dashed"});i.selfLinks.exit().remove();i.nodes=i.conf.domSvg.selectAll("circle.node").data(i.data.nodes,function(e){return i.conf.domContainerId+"_node_"+e.ID}).attr("r",function(e){return e.radius}).style("fill",null).style("fill",function(e){return i.tools.color(e.COLORVALUE)});i.nodes.enter().append("svg:circle").attr("id",function(e){return i.conf.domContainerId+"_node_"+e.ID}).attr("class","node").attr("r",function(e){return e.radius}).style("fill",function(e){return i.tools.color(e.COLORVALUE)}).on("mouseenter",i.tools.onNodeMouseenter).on("mouseleave",i.tools.onNodeMouseleave).on("click",i.tools.onNodeClick).on("dblclick",i.tools.onNodeDblclick).on("contextmenu",i.tools.onNodeContextmenu);i.nodes.exit().remove();i.labels=i.conf.domSvg.selectAll("text.label").data(i.data.nodes.filter(function(e){return!e.LABELCIRCULAR&&!i.conf.labelsCircular}),function(e){return i.conf.domContainerId+"_label_"+e.ID}).text(function(e){return e.LABEL});i.labels.enter().append("svg:text").attr("id",function(e){return i.conf.domContainerId+"_label_"+e.ID}).attr("class","label").text(function(e){return e.LABEL});i.labels.exit().remove();i.labelPaths=i.conf.domSvgDefs.selectAll("path.label").data(i.data.nodes.filter(function(e){return e.LABELCIRCULAR||i.conf.labelsCircular}),function(e){return i.conf.domContainerId+"_textPath_"+e.ID}).attr("d",function(e){return i.tools.getLabelPath(e)});i.labelPaths.enter().append("svg:path").attr("id",function(e){return i.conf.domContainerId+"_textPath_"+e.ID}).attr("class","label").attr("d",function(e){return i.tools.getLabelPath(e)});i.labelPaths.exit().remove();i.labelsCircular=i.conf.domSvg.selectAll("text.labelCircular").data(i.data.nodes.filter(function(e){return e.LABELCIRCULAR||i.conf.labelsCircular}),function(e){return i.conf.domContainerId+"_labelCircular_"+e.ID}).each(function(e){d3.select("#"+i.conf.domContainerId+"_pathReference_"+e.ID).text(e.LABEL)});i.labelsCircular.enter().append("svg:text").attr("id",function(e){return i.conf.domContainerId+"_labelCircular_"+e.ID}).attr("class","labelCircular").append("svg:textPath").attr("id",function(e){return i.conf.domContainerId+"_pathReference_"+e.ID}).attr("xlink:href",function(e){return"#"+i.conf.domContainerId+"_textPath_"+e.ID}).text(function(e){return e.LABEL});i.labelsCircular.exit().remove();if(!i.conf.customize&&(i.conf.debug||document.querySelector("#apex-dev-toolbar")!==null)){if(document.querySelector("#"+i.conf.domContainerId+" svg text.link")===null){i.conf.domSvg.append("svg:text").attr("class","link").attr("x",5).attr("y",15).attr("text-anchor","start").text("Customize Me").on("click",function(){i.conf.customize=true;s()})}}else{i.conf.domSvg.select("#"+i.conf.domContainerId+" svg text.link").remove()}if(i.conf.dragMode){i.nodes.call(i.drag)}else{i.nodes.on("mousedown.drag",null)}if(i.conf.pinMode&&i.conf.dragMode){i.drag.on("dragstart",function(e){d3.select(this).classed("fixed",e.fixed=true)})}else{i.drag.on("dragstart",null)}if(i.conf.useDomParentWidth){i.conf.domContainerWidth=i.tools.getSvgParentInnerWidth();d3.select(window).on("resize",function(){var e=i.conf.domContainerWidth;var t=i.tools.getSvgParentInnerWidth();if(e!==t){i.conf.domContainerWidth=t;s()}})}else{d3.select(window).on("resize",null)}i.conf.domSvg.attr("width",i.conf.useDomParentWidth?i.conf.domContainerWidth:i.conf.width).attr("height",i.conf.height);i.force.nodes(i.data.nodes).links(i.data.links).size([i.conf.useDomParentWidth?i.conf.domContainerWidth:i.conf.width,i.conf.height]).friction(i.conf.friction).charge(i.conf.charge).theta(i.conf.theta).gravity(i.conf.gravity).linkDistance(i.conf.linkDistance).linkStrength(i.conf.linkStrength).start();if(i.conf.autoRefresh&&i.conf.refreshInterval&&!i.conf.interval){i.conf.interval=window.setInterval(function(){s.start()},i.conf.refreshInterval);i.tools.log("Auto refresh started with an interval of "+i.conf.refreshInterval+" milliseconds.")}else if(i.conf.autoRefresh===false&&i.conf.interval){clearInterval(i.conf.interval);i.conf.interval=null;i.tools.log("Auto refresh stopped.")}i.tools.triggerApexEvent(document.querySelector("#"+i.conf.domContainerId),"apexafterrefresh")}var i={version:"1.0.3"};i.conf={};i.data={};i.tools={};i.conf.domContainerId=e||"D3Force"+Math.floor(Math.random()*1e6);i.confUser=t||{};i.conf.apexPluginId=n;i.conf.apexPageItemsToSubmit=r;i.conf.debugPrefix="D3 Force in DOM container #"+i.conf.domContainerId+": ";if(i.conf.apexPluginId&&apex.jQuery("#pdebug").length==1){i.conf.debug=true}else{i.conf.debug=false}i.tickCounter;i.startTime;i.confDefaults={showBorder:{type:"bool",val:true,options:[true,false]},showSelfLinks:{type:"bool",val:true,options:[true,false]},showLinkDirection:{type:"bool",val:true,options:[true,false]},showTooltips:{type:"bool",val:true,options:[true,false]},tooltipPosition:{type:"text",val:"node",options:["node","svgTopLeft","svgTopRight"]},colorScheme:{type:"text",val:"color20",options:["color20","color20b","color20c","color10","direct"]},labelsCircular:{type:"bool",val:false,options:[true,false]},dragMode:{type:"bool",val:true,options:[true,false]},pinMode:{type:"bool",val:false,options:[true,false]},nodeEventToStopPinMode:{type:"text",val:"contextmenu",options:["none","dblclick","contextmenu"]},onNodeContextmenuPreventDefault:{type:"bool",val:false,options:[true,false]},nodeEventToOpenLink:{type:"text",val:"dblclick",options:["none","click","dblclick","contextmenu"]},nodeLinkTarget:{type:"text",val:"_blank",options:["none","_blank","nodeID"]},autoRefresh:{type:"bool",val:false,options:[true,false]},refreshInterval:{type:"number",val:5e3,options:[6e4,3e4,15e3,1e4,5e3,2500]},useDomParentWidth:{type:"bool",val:false,options:[true,false]},width:{type:"number",val:500,options:[1200,1150,1100,1050,1e3,950,900,850,800,750,700,650,600,550,500,450,400,350,300]},height:{type:"number",val:500,options:[1200,1150,1100,1050,1e3,950,900,850,800,750,700,650,600,550,500,450,400,350,300]},minNodeRadius:{type:"number",val:6,options:[12,11,10,9,8,7,6,5,4,3,2,1]},maxNodeRadius:{type:"number",val:18,options:[36,34,32,30,28,26,24,22,20,18,16,14,12]},labelDistance:{type:"number",val:12,options:[30,28,26,24,22,20,18,16,14,12,10,8,6,4,2]},selfLinkDistance:{type:"number",val:20,options:[30,28,26,24,22,20,18,16,14,12,10,8]},linkDistance:{type:"number",val:80,options:[120,110,100,90,80,70,60,50,40,30,20]},charge:{type:"number",val:-350,options:[-1e3,-950,-900,-850,-800,-750,-700,-650,-600,-550,-500,-450,-400,-350,-300,-250,-200,-150,-100,-50,0],internal:true},gravity:{type:"number",val:.1,options:[1,.95,.9,.85,.8,.75,.7,.65,.6,.55,.5,.45,.4,.35,.3,.25,.2,.15,.1,.05,0],internal:true},linkStrength:{type:"number",val:1,options:[1,.95,.9,.85,.8,.75,.7,.65,.6,.55,.5,.45,.4,.35,.3,.25,.2,.15,.1,.05,0],internal:true},friction:{type:"number",val:.9,options:[1,.95,.9,.85,.8,.75,.7,.65,.6,.55,.5,.45,.4,.35,.3,.25,.2,.15,.1,.05,0],internal:true},theta:{type:"number",val:.8,options:[1,.95,.9,.85,.8,.75,.7,.65,.6,.55,.5,.45,.4,.35,.3,.25,.2,.15,.1,.05,0],internal:true}};i.conf.customize=false;i.conf.debug=i.confUser.debug||false;i.conf.showBorder=typeof i.confUser.showBorder!=="undefined"?i.confUser.showBorder:i.confDefaults.showBorder.val;i.conf.showSelfLinks=typeof i.confUser.showSelfLinks!=="undefined"?i.confUser.showSelfLinks:i.confDefaults.showSelfLinks.val;i.conf.showLinkDirection=typeof i.confUser.showLinkDirection!=="undefined"?i.confUser.showLinkDirection:i.confDefaults.showLinkDirection.val;i.conf.showTooltips=typeof i.confUser.showTooltips!=="undefined"?i.confUser.showTooltips:i.confDefaults.showTooltips.val;i.conf.tooltipPosition=i.confUser.tooltipPosition||i.confDefaults.tooltipPosition.val;i.conf.colorScheme=i.confUser.colorScheme||i.confDefaults.colorScheme.val;i.conf.labelsCircular=typeof i.confUser.labelsCircular!=="undefined"?i.confUser.labelsCircular:i.confDefaults.labelsCircular.val;i.conf.dragMode=typeof i.confUser.dragMode!=="undefined"?i.confUser.dragMode:i.confDefaults.dragMode.val;i.conf.pinMode=typeof i.confUser.pinMode!=="undefined"?i.confUser.pinMode:i.confDefaults.pinMode.val;i.conf.nodeEventToStopPinMode=i.confUser.nodeEventToStopPinMode||i.confDefaults.nodeEventToStopPinMode.val;i.conf.onNodeContextmenuPreventDefault=typeof i.confUser.onNodeContextmenuPreventDefault!=="undefined"?i.confUser.onNodeContextmenuPreventDefault:i.confDefaults.onNodeContextmenuPreventDefault.val;i.conf.nodeEventToOpenLink=i.confUser.nodeEventToOpenLink||i.confDefaults.nodeEventToOpenLink.val;i.conf.nodeLinkTarget=i.confUser.nodeLinkTarget||i.confDefaults.nodeLinkTarget.val;i.conf.autoRefresh=typeof i.confUser.autoRefresh!=="undefined"?i.confUser.autoRefresh:i.confDefaults.autoRefresh.val;i.conf.refreshInterval=i.confUser.refreshInterval||i.confDefaults.refreshInterval.val;i.conf.useDomParentWidth=typeof i.confUser.useDomParentWidth!=="undefined"?i.confUser.useDomParentWidth:i.confDefaults.useDomParentWidth.val;i.conf.width=i.confUser.width||i.confDefaults.width.val;i.conf.height=i.confUser.height||i.confDefaults.height.val;i.conf.minNodeRadius=i.confUser.minNodeRadius||i.confDefaults.minNodeRadius.val;i.conf.maxNodeRadius=i.confUser.maxNodeRadius||i.confDefaults.maxNodeRadius.val;i.conf.labelDistance=i.confUser.labelDistance||i.confDefaults.labelDistance.val;i.conf.selfLinkDistance=i.confUser.selfLinkDistance||i.confDefaults.selfLinkDistance.val;i.conf.linkDistance=i.confUser.linkDistance||i.confDefaults.linkDistance.val;i.conf.chargeDistance=i.confUser.chargeDistance||null;i.conf.charge=i.confUser.charge||i.confDefaults.charge.val;i.conf.gravity=i.confUser.gravity||i.confDefaults.gravity.val;i.conf.linkStrength=i.confUser.linkStrength||i.confDefaults.linkStrength.val;i.conf.friction=i.confUser.friction||i.confDefaults.friction.val;i.conf.theta=i.confUser.theta||i.confDefaults.theta.val;i.conf.onNodeMouseenterFunction=i.confUser.onNodeMouseenterFunction||null;i.conf.onNodeMouseleaveFunction=i.confUser.onNodeMouseleaveFunction||null;i.conf.onNodeClickFunction=i.confUser.onNodeClickFunction||null;i.conf.onNodeDblclickFunction=i.confUser.onNodeDblclickFunction||null;i.conf.onNodeContextmenuFunction=i.confUser.onNodeContextmenuFunction||null;i.conf.currentTabPosition=null;i.conf.sampleData=false;i.data.sampleData="<data>"+'<nodes ID="7839" LABEL="KING is THE KING, you know?" COLORVALUE="10" SIZEVALUE="5000" LABELCIRCULAR="true" LINK="http://apex.oracle.com/"'+' INFOSTRING="This visualization is based on the well known emp table." />'+'<nodes ID="7698" LABEL="BLAKE" COLORVALUE="30" SIZEVALUE="2850"/>'+'<nodes ID="7782" LABEL="CLARK" COLORVALUE="10" SIZEVALUE="2450"/>'+'<nodes ID="7566" LABEL="JONES" COLORVALUE="20" SIZEVALUE="2975"/>'+'<nodes ID="7788" LABEL="SCOTT" COLORVALUE="20" SIZEVALUE="3000"/>'+'<nodes ID="7902" LABEL="FORD" COLORVALUE="20" SIZEVALUE="3000"/>'+'<nodes ID="7369" LABEL="SMITH" COLORVALUE="20" SIZEVALUE="800"/>'+'<nodes ID="7499" LABEL="ALLEN" COLORVALUE="30" SIZEVALUE="1600"/>'+'<nodes ID="7521" LABEL="WARD" COLORVALUE="30" SIZEVALUE="1250"/>'+'<nodes ID="7654" LABEL="MARTIN" COLORVALUE="30" SIZEVALUE="1250"/>'+'<nodes ID="7844" LABEL="TURNER" COLORVALUE="30" SIZEVALUE="1500"/>'+'<nodes ID="7876" LABEL="ADAMS" COLORVALUE="20" SIZEVALUE="1100"/>'+'<nodes ID="7900" LABEL="JAMES" COLORVALUE="30" SIZEVALUE="950"/>'+'<nodes ID="7934" LABEL="MILLER" COLORVALUE="10" SIZEVALUE="1300"/>'+'<nodes ID="8888" LABEL="Who am I?" COLORVALUE="green" SIZEVALUE="2000" INFOSTRING="This is a good question. Think about it." />'+'<nodes ID="9999" LABEL="Where I am?" COLORVALUE="#f00" SIZEVALUE="1000" INFOSTRING="This is a good question. What do you think?" />'+'<links FROMID="7839" TOID="7839" STYLE="dashed"/>'+'<links FROMID="7698" TOID="7839" STYLE="solid"/>'+'<links FROMID="7782" TOID="7839" STYLE="solid"/>'+'<links FROMID="7566" TOID="7839" STYLE="solid"/>'+'<links FROMID="7788" TOID="7566" STYLE="solid"/>'+'<links FROMID="7902" TOID="7566" STYLE="solid"/>'+'<links FROMID="7369" TOID="7902" STYLE="solid"/>'+'<links FROMID="7499" TOID="7698" STYLE="solid"/>'+'<links FROMID="7521" TOID="7698" STYLE="solid"/>'+'<links FROMID="7654" TOID="7698" STYLE="solid"/>'+'<links FROMID="7844" TOID="7698" STYLE="solid"/>'+'<links FROMID="7876" TOID="7788" STYLE="solid"/>'+'<links FROMID="7900" TOID="7698" STYLE="solid"/>'+'<links FROMID="7934" TOID="7782" STYLE="solid"/>'+"</data>";if(document.querySelector("#"+i.conf.domContainerId)===null){i.conf.domContainer=d3.select("body").append("div").attr("id",i.conf.domContainerId)}else{i.conf.domContainer=d3.select("#"+i.conf.domContainerId);d3.selectAll("#"+i.conf.domContainerId+"_tooltip, #"+i.conf.domContainerId+"_customizing").remove()}if(document.querySelector("#"+i.conf.domContainerId+" svg")===null){i.conf.domSvg=i.conf.domContainer.append("svg")}else{i.conf.domSvg=d3.select("#"+i.conf.domContainerId+" svg");d3.select("#"+i.conf.domContainerId+" svg defs").remove()}i.conf.domSvg.attr("id",i.conf.domContainerId+"_svg").attr("class","net_gobrechts_d3_force").classed("border",i.conf.showBorder).attr("width",i.conf.width).attr("height",i.conf.height);i.conf.domSvgDefs=i.conf.domSvg.append("defs");i.conf.domSvgDefs.append("svg:marker").attr("id",i.conf.domContainerId+"_highlightedTriangle").attr("class","highlighted").attr("viewBox","0 0 10 10").attr("refX",10).attr("refY",5).attr("markerWidth",5).attr("markerHeight",5).attr("orient","auto").attr("markerUnits","strokeWidth").append("svg:path").attr("d","M0,0 L10,5 L0,10");i.conf.domSvgDefs.append("svg:marker").attr("id",i.conf.domContainerId+"_normalTriangle").attr("class","normal").attr("viewBox","0 0 10 10").attr("refX",10).attr("refY",5).attr("markerWidth",5).attr("markerHeight",5).attr("orient","auto").attr("markerUnits","strokeWidth").append("svg:path").attr("d","M0,0 L10,5 L0,10");i.conf.domTooltip=i.conf.domContainer.append("div").attr("id",i.conf.domContainerId+"_tooltip").attr("class","net_gobrechts_d3_force_tooltip").style("top","0px").style("left","0px");i.tools.log=function(e,t){if(i.conf.debug){if(t)console.log(e);else console.log(i.conf.debugPrefix+e)}if(i.conf.customize)i.conf.domCustomizeLog.text(e+"\n"+i.conf.domCustomizeLog.text())};i.tools.logError=function(e,t){console.log(i.conf.debugPrefix+"ERROR: "+e);if(i.conf.customize)i.conf.domCustomizeLog.text("ERROR: "+e+"\n"+i.conf.domCustomizeLog.text())};i.tools.triggerApexEvent=function(e,t,n){if(i.conf.apexPluginId)apex.event.trigger(e,t,n)};i.tools.neighboring=function(e,t){return i.data.neighbors.indexOf(e.ID+":"+t.ID)>-1||i.data.neighbors.indexOf(t.ID+":"+e.ID)>-1};i.tools.adjustSourceX=function(e){return e.source.x+Math.cos(i.tools.calcAngle(e))*e.source.radius};i.tools.adjustSourceY=function(e){return e.source.y+Math.sin(i.tools.calcAngle(e))*e.source.radius};i.tools.adjustTargetX=function(e){return e.target.x-Math.cos(i.tools.calcAngle(e))*e.target.radius};i.tools.adjustTargetY=function(e){return e.target.y-Math.sin(i.tools.calcAngle(e))*e.target.radius};i.tools.calcAngle=function(e){return Math.atan2(e.target.y-e.source.y,e.target.x-e.source.x)};i.tools.getSelfLinkPath=function(e){var t=e.source.radius;var n=e.source.radius+i.conf.selfLinkDistance;var r=0;var s=0;var o={source:{x:0,y:0,radius:t},target:{x:r+n/2,y:s+n,radius:t}};var u={source:{x:r-n/2,y:s+n,radius:t},target:{x:r,y:s,radius:t}};var a="M"+i.tools.adjustSourceX(o)+","+i.tools.adjustSourceY(o);a+=" L"+(r+n/2)+","+(s+n);a+=" A"+n+","+n+" 0 0,1 "+(r-n/2)+","+(s+n);a+=" L"+i.tools.adjustTargetX(u)+","+i.tools.adjustTargetY(u);return a};i.tools.getLabelPath=function(e){var t=e.radius+i.conf.labelDistance;var n=0;var r=0;var s="M"+(n-t)+","+r;s+=" a"+t+","+t+" 0 0,1 "+t*2+",0";s+=" a"+t+","+t+" 0 0,1 -"+t*2+",0";return s};i.tools.openLink=function(e){var t;if(i.conf.nodeLinkTarget=="none"){window.location.assign(e.LINK)}else if(i.conf.nodeLinkTarget=="nodeID"){t=window.open(e.LINK,e.ID);t.focus()}else{t=window.open(e.LINK,i.conf.nodeLinkTarget);t.focus()}};i.tools.onNodeMouseenter=function(e){var t;i.nodes.classed("highlighted",function(t){return i.tools.neighboring(t,e)});i.links.classed("highlighted",function(t){return t.source.ID==e.ID||t.target.ID==e.ID}).style("marker-end",function(t){if(i.conf.showLinkDirection){return"url(#"+i.conf.domContainerId+"_"+(t.source.ID==e.ID||t.target.ID==e.ID?"highlighted":"normal")+"Triangle)"}else{return null}});i.selfLinks.classed("highlighted",function(t){return t.FROMID==e.ID}).style("marker-end",function(t){if(i.conf.showLinkDirection){return"url(#"+i.conf.domContainerId+"_"+(t.source.ID==e.ID||t.target.ID==e.ID?"highlighted":"normal")+"Triangle)"}else{return null}});d3.select(this).classed("highlighted",true);i.tools.log("Event mouseenter triggered.");i.tools.triggerApexEvent(this,"net_gobrechts_d3_force_mouseenter",e);if(typeof i.conf.onNodeMouseenterFunction=="function")i.conf.onNodeMouseenterFunction.call(this,d3.event,e);if(i.conf.showTooltips&&e.INFOSTRING){i.conf.domTooltip.html(e.INFOSTRING).style("display","block");if(i.conf.tooltipPosition==="svgTopLeft"){t=i.tools.getOffsetRect(document.querySelector("#"+i.conf.domContainerId+" svg"));i.conf.domTooltip.style("top",t.top+(i.conf.domSvg.style("border-width")?parseInt(i.conf.domSvg.style("border-width")):1)+"px").style("left",t.left+(i.conf.domSvg.style("border-width")?parseInt(i.conf.domSvg.style("border-width")):1)+"px")}else if(i.conf.tooltipPosition==="svgTopRight"){t=i.tools.getOffsetRect(document.querySelector("#"+i.conf.domContainerId+" svg"));i.conf.domTooltip.style("top",t.top+parseInt(i.conf.domSvg.style("border-width")?parseInt(i.conf.domSvg.style("border-width")):1)+"px").style("left",t.left+parseInt(i.conf.domSvg.style("width"))+parseInt(i.conf.domSvg.style("border-width")?parseInt(i.conf.domSvg.style("border-width")):1)-parseInt(i.conf.domTooltip.style("width"))-2*parseInt(i.conf.domTooltip.style("border-width")?parseInt(i.conf.domTooltip.style("border-width")):0)-parseInt(i.conf.domTooltip.style("padding-left"))-parseInt(i.conf.domTooltip.style("padding-right"))+"px")}else{i.conf.domTooltip.style("left",d3.event.pageX+"px").style("top",d3.event.pageY+"px")}}};i.tools.onNodeMouseleave=function(e){i.nodes.classed("highlighted",false);i.links.classed("highlighted",false).style("marker-end",i.conf.showLinkDirection?"url(#"+i.conf.domContainerId+"_normalTriangle)":null);i.selfLinks.classed("highlighted",false).style("marker-end",i.conf.showLinkDirection?"url(#"+i.conf.domContainerId+"_normalTriangle)":null);i.labels.classed("highlighted",false);i.tools.log("Event mouseleave triggered.");i.tools.triggerApexEvent(this,"net_gobrechts_d3_force_mouseleave",e);if(typeof i.conf.onNodeMouseleaveFunction=="function")i.conf.onNodeMouseleaveFunction.call(this,d3.event,e);if(i.conf.showTooltips)i.conf.domTooltip.style("display","none")};i.tools.onNodeClick=function(e){if(e.LINK&&i.conf.nodeEventToOpenLink=="click")i.tools.openLink(e);if(i.conf.pinMode&&i.conf.nodeEventToStopPinMode=="click")d3.select(this).classed("fixed",e.fixed=false);i.tools.log("Event click triggered.");i.tools.triggerApexEvent(this,"net_gobrechts_d3_force_click",e);if(typeof i.conf.onNodeClickFunction=="function")i.conf.onNodeClickFunction.call(this,d3.event,e)};i.tools.onNodeDblclick=function(e){if(e.LINK&&i.conf.nodeEventToOpenLink=="dblclick")i.tools.openLink(e);if(i.conf.pinMode&&i.conf.nodeEventToStopPinMode=="dblclick")d3.select(this).classed("fixed",e.fixed=false);i.tools.log("Event dblclick triggered.");i.tools.triggerApexEvent(this,"net_gobrechts_d3_force_dblclick",e);if(typeof i.conf.onNodeDblclickFunction=="function")i.conf.onNodeDblclickFunction.call(this,d3.event,e)};i.tools.onNodeContextmenu=function(e){if(i.conf.onNodeContextmenuPreventDefault)d3.event.preventDefault();if(e.LINK&&i.conf.nodeEventToOpenLink=="contextmenu")i.tools.openLink(e);if(i.conf.pinMode&&i.conf.nodeEventToStopPinMode=="contextmenu")d3.select(this).classed("fixed",e.fixed=false);i.tools.log("Event contextmenu triggered.");i.tools.triggerApexEvent(this,"net_gobrechts_d3_force_contextmenu",e);if(typeof i.conf.onNodeContextmenuFunction=="function")i.conf.onNodeContextmenuFunction.call(this,d3.event,e)};i.tools.x2js=new X2JS({attributePrefix:"none"});i.tools.getSvgParentInnerWidth=function(){var e=d3.select(i.conf.domSvg.node().parentNode);return parseInt(e.style("width"))-parseInt(e.style("padding-left"))-parseInt(e.style("padding-right"))-(i.conf.domSvg.style("border-width")?parseInt(i.conf.domSvg.style("border-width")):1)*2};i.tools.getOffsetRect=function(e){var t=e.getBoundingClientRect();var n=document.body;var r=document.documentElement;var i=window.pageYOffset||r.scrollTop||n.scrollTop;var s=window.pageXOffset||r.scrollLeft||n.scrollLeft;var o=r.clientTop||n.clientTop||0;var u=r.clientLeft||n.clientLeft||0;var a=t.top+i-o;var f=t.left+s-u;return{top:Math.round(a),left:Math.round(f)}};i.tools.customizeDrag=d3.behavior.drag().on("dragstart",function(){var e=d3.mouse(document.body);i.conf.domCustomizePosition=i.tools.getOffsetRect(document.querySelector("#"+i.conf.domContainerId+"_customizing"));i.conf.domCustomizePosition.mouseLeft=e[0]-i.conf.domCustomizePosition.left;i.conf.domCustomizePosition.mouseTop=e[1]-i.conf.domCustomizePosition.top}).on("drag",function(){var e=d3.mouse(document.body);i.conf.domCustomize.style("left",Math.max(0,e[0]-i.conf.domCustomizePosition.mouseLeft)+"px").style("top",Math.max(0,e[1]-i.conf.domCustomizePosition.mouseTop)+"px")}).on("dragend",function(){i.conf.domCustomizePosition=i.tools.getOffsetRect(i.conf.domCustomize.node())});i.tools.customizeChart=function(){var e,t,n,r,o=0,u,a,f;if(!i.conf.domCustomizePosition){i.conf.domCustomizePosition=i.tools.getOffsetRect(i.conf.domSvg.node());i.conf.domCustomizePosition.left=i.conf.domCustomizePosition.left+i.conf.width+8;i.conf.domCustomizePosition.top=i.conf.domCustomizePosition.top}if(document.querySelector("#"+i.conf.domContainerId+"_customizing")!==null){i.conf.domCustomize.remove()}i.conf.domCustomize=i.conf.domContainer.append("div").attr("id",i.conf.domContainerId+"_customizing").attr("class","net_gobrechts_d3_force_customize").style("left",i.conf.domCustomizePosition.left+"px").style("top",i.conf.domCustomizePosition.top+"px");i.conf.domCustomize.append("span").attr("class","drag").call(i.tools.customizeDrag).append("span").attr("class","title").text('Customize "'+i.conf.domContainerId+'"');i.conf.domCustomize.append("a").attr("class","close focus").attr("tabindex",1).text("Close").on("click",function(){i.conf.customize=false;s()}).on("keydown",function(){if(d3.event.keyCode==13){i.conf.customize=false;s()}});e=i.conf.domCustomize.append("table");for(var l in i.confDefaults){if(i.confDefaults.hasOwnProperty(l)){o+=1;t=e.append("tr");t.append("td").attr("class","label").html('<a href="https://github.com/ogobrecht/d3-force-apex-plugin/wiki/API-Reference#'+l.toLowerCase()+'" target="github_d3_force" tabindex="'+o+100+'">'+l+"</a>");n=t.append("td");r=n.append("select").attr("id",i.conf.domContainerId+"_"+l).attr("name",l).attr("value",i.conf[l]).attr("tabindex",o+1).classed("warning",i.confDefaults[l].internal).on("change",function(){i.conf.currentTabPosition=this.id;if(i.confDefaults[this.name].type=="text"){i.conf[this.name]=this.options[this.selectedIndex].value}else if(i.confDefaults[this.name].type=="number"){i.conf[this.name]=parseFloat(this.options[this.selectedIndex].value)}else if(i.confDefaults[this.name].type=="bool"){i.conf[this.name]=this.options[this.selectedIndex].value=="true"?true:false}i.tools.createCustomizingConfObject();s()});f=false;i.confDefaults[l].options.forEach(function(e){a=e;r.append("option").attr("value",e).attr("selected",function(){if(i.confDefaults[l].type=="text"||i.confDefaults[l].type=="bool"){if(a==i.conf[l]){f=true;return"selected"}else{return null}}else if(i.confDefaults[l].type=="number"){if(parseFloat(a)==i.conf[l]){f=true;return"selected"}else{return null}}}).text(e)});if(!f){r.append("option").attr("value",i.conf[l]).attr("selected","selected").text(i.conf[l]);i.confDefaults[l].options.push(i.conf[l])}if(o==1){u=t.append("td").style("vertical-align","top").style("padding-left","5px")}}}u.attr("rowspan",o).html('Your Configuration Object<br><textarea id="'+i.conf.domContainerId+'_conf_object" tabindex="'+(o+2)+'" readonly></textarea><br><br>'+"Current Positions<br>"+'<textarea id="'+i.conf.domContainerId+'_positions" tabindex="'+(o+3)+'" readonly>Force started - wait for end event to show positions...</textarea><br><br>'+"Debug Log (descending)<br>"+'<textarea id="'+i.conf.domContainerId+'_log" tabindex="'+(o+4)+'" readonly></textarea><br><br>'+"Copyrights<br><br>"+'<a href="https://github.com/ogobrecht/d3-force-apex-plugin" target="github_d3_force" tabindex="'+(o+5)+'">D3 Force APEX Plugin</a> ('+i.version+")<br>"+"Ottmar Gobrecht<br><br>"+'<a href="http://d3js.org" target="d3js_org" tabindex="'+(o+6)+'">D3.js</a> ('+d3.version+")<br>"+"Mike Bostock<br><br>"+'<a href="https://code.google.com/p/x2js/" target="code_google_com" tabindex="'+(o+7)+'">X2JS</a> ('+i.tools.x2js.getVersion()+" modified)<br>"+"Abdulla Abdurakhmanov<br><br>");i.conf.domCustomizeConfObject=d3.select("#"+i.conf.domContainerId+"_conf_object");i.conf.domCustomizePositions=d3.select("#"+i.conf.domContainerId+"_positions");i.conf.domCustomizeLog=d3.select("#"+i.conf.domContainerId+"_log");i.tools.createCustomizingConfObject();if(i.conf.currentTabPosition)document.getElementById(i.conf.currentTabPosition).focus();else document.querySelector("#"+i.conf.domContainerId+"_customizing select").focus()};i.tools.createCustomizingConfObject=function(){var e="{\n";for(var t in i.confDefaults){if(i.confDefaults.hasOwnProperty(t)){if(i.confDefaults[t].type=="range"||i.confDefaults[t].type=="number"||i.confDefaults[t].type=="bool"){e+='"'+t+'":'+i.conf[t]+",\n"}else{e+='"'+t+'":"'+i.conf[t]+'",\n'}}}e=e.substr(0,e.length-2)+"\n}";i.conf.domCustomizeConfObject.text(e)};i.force=d3.layout.force().on("start",function(){i.tools.log("Force started.");if(i.conf.customize)i.conf.domCustomizePositions.text("Force started - wait for end event to show positions...");i.tickCounter=0;i.startTime=(new Date).getTime()}).on("tick",function(){i.selfLinks.attr("transform",function(e){return"translate("+e.source.x+","+e.source.y+")"});i.links.attr("x1",function(e){return i.tools.adjustSourceX(e)}).attr("y1",function(e){return i.tools.adjustSourceY(e)}).attr("x2",function(e){return i.tools.adjustTargetX(e)}).attr("y2",function(e){return i.tools.adjustTargetY(e)});i.labels.attr("x",function(e){return e.x}).attr("y",function(e){return e.y-e.radius-i.conf.labelDistance});i.labelPaths.attr("transform",function(e){return"translate("+e.x+","+e.y+")"});i.nodes.attr("cx",function(e){return e.x}).attr("cy",function(e){return e.y});i.tickCounter+=1}).on("end",function(){var e=(new Date).getTime()-i.startTime;var t=(e/1e3).toFixed(1);var n=Math.round(i.tickCounter/(e/1e3));var r=Math.round(e/i.tickCounter);if(i.conf.customize)i.conf.domCustomizePositions.text(s.positions());i.tools.log("Force ended.");i.tools.log(t+" seconds, "+i.tickCounter+" ticks to cool down ("+n+" ticks/s, "+r+" ms/tick).")});i.drag=i.force.drag();s.start=function(e){var t;if(e){s(e)}else if(i.conf.apexPluginId){apex.server.plugin(i.conf.apexPluginId,{p_debug:$v("pdebug"),pageItems:i.conf.apexPageItemsToSubmit.split(",")},{success:function(e){t=e.trim().substr(0,1);if(t=="<"||t=="{"){s(e)}else{s();i.tools.logError("Unable to load new data: "+e)}},error:function(){i.tools.logError("Unable to load new data - AJAX call terminated with errors.")},dataType:"text"})}else{s()}return s};s.showBorder=function(e){if(!arguments.length)return i.conf.showBorder;i.conf.showBorder=e;return s};s.showSelfLinks=function(e){if(!arguments.length)return i.conf.showSelfLinks;i.conf.showSelfLinks=e;return s};s.showLinkDirection=function(e){if(!arguments.length)return i.conf.showLinkDirection;i.conf.showLinkDirection=e;return s};s.showTooltips=function(e){if(!arguments.length)return i.conf.showTooltips;i.conf.showTooltips=e;return s};s.tooltipPosition=function(e){if(!arguments.length)return i.conf.tooltipPosition;i.conf.tooltipPosition=e;return s};s.colorScheme=function(e){if(!arguments.length)return i.conf.colorScheme;i.conf.colorScheme=e;return s};s.labelsCircular=function(e){if(!arguments.length)return i.conf.labelsCircular;i.conf.labelsCircular=e;return s};s.dragMode=function(e){if(!arguments.length)return i.conf.dragMode;i.conf.dragMode=e;return s};s.pinMode=function(e){if(!arguments.length)return i.conf.pinMode;i.conf.pinMode=e;return s};s.nodeEventToStopPinMode=function(e){if(!arguments.length)return i.conf.nodeEventToStopPinMode;i.conf.nodeEventToStopPinMode=e;return s};s.onNodeContextmenuPreventDefault=function(e){if(!arguments.length)return i.conf.onNodeContextmenuPreventDefault;i.conf.onNodeContextmenuPreventDefault=e;return s};s.nodeEventToOpenLink=function(e){if(!arguments.length)return i.conf.nodeEventToOpenLink;i.conf.nodeEventToOpenLink=e;return s};s.nodeLinkTarget=function(e){if(!arguments.length)return i.conf.nodeLinkTarget;i.conf.nodeLinkTarget=e;return s};s.autoRefresh=function(e){if(!arguments.length)return i.conf.autoRefresh;i.conf.autoRefresh=e;return s};s.refreshInterval=function(e){if(!arguments.length)return i.conf.refreshInterval;i.conf.refreshInterval=e;return s};s.useDomParentWidth=function(e){if(!arguments.length)return i.conf.useDomParentWidth;i.conf.useDomParentWidth=e;return s};s.width=function(e){if(!arguments.length)return i.conf.width;i.conf.width=e;return s};s.height=function(e){if(!arguments.length)return i.conf.height;i.conf.height=e;return s};s.minNodeRadius=function(e){if(!arguments.length)return i.conf.minNodeRadius;i.conf.minNodeRadius=e;return s};s.maxNodeRadius=function(e){if(!arguments.length)return i.conf.maxNodeRadius;i.conf.maxNodeRadius=e;return s};s.labelDistance=function(e){if(!arguments.length)return i.conf.labelDistance;i.conf.labelDistance=e;return s};s.selfLinkDistance=function(e){if(!arguments.length)return i.conf.selfLinkDistance;i.conf.selfLinkDistance=e;return s};s.linkDistance=function(e){if(!arguments.length)return i.conf.linkDistance;i.conf.linkDistance=e;return s};s.charge=function(e){if(!arguments.length)return i.conf.charge;i.conf.charge=e;return s};s.gravity=function(e){if(!arguments.length)return i.conf.gravity;i.conf.gravity=e;return s};s.chargeDistance=function(e){if(!arguments.length)return i.conf.chargeDistance;i.conf.chargeDistance=e;return s};s.linkStrength=function(e){if(!arguments.length)return i.conf.linkStrength;i.conf.linkStrength=e;return s};s.friction=function(e){if(!arguments.length)return i.conf.friction;i.conf.friction=e;return s};s.theta=function(e){if(!arguments.length)return i.conf.theta;i.conf.theta=e;return s};s.positions=function(e){if(!arguments.length){var t="[\n";i.data.nodes.forEach(function(e){t+='{"ID":"'+e.ID+'","x":'+e.x+',"y":'+e.y+',"fixed":'+(e.fixed?1:0)+"},\n"});return t.substr(0,t.length-2)+"\n]"}else{i.conf.positions=e;return s}};s.onNodeMouseenterFunction=function(e){if(!arguments.length)return i.conf.onNodeMouseenterFunction;i.conf.onNodeMouseenterFunction=e;return s};s.onNodeMouseleaveFunction=function(e){if(!arguments.length)return i.conf.onNodeMouseleaveFunction;i.conf.onNodeMouseleaveFunction=e;return s};s.onNodeClickFunction=function(e){if(!arguments.length)return i.conf.onNodeClickFunction;i.conf.onNodeClickFunction=e;return s};s.onNodeDblclickFunction=function(e){if(!arguments.length)return i.conf.onNodeDblclickFunction;i.conf.onNodeDblclickFunction=e;return s};s.onNodeContextmenuFunction=function(e){if(!arguments.length)return i.conf.onNodeContextmenuFunction;i.conf.onNodeContextmenuFunction=e;return s};s.sampleData=function(e){if(!arguments.length)return i.data.sampleData;i.data.sampleData=e;return s};s.customize=function(e){if(!arguments.length)return i.conf.customize;i.conf.customize=e;if(i.conf.customize)i.conf.debug=true;return s};s.debug=function(e){if(!arguments.length)return i.conf.debug;i.conf.debug=e;return s};s.inspect=function(){return i};s.version=function(){return i.version};if(i.conf.apexPluginId){apex.jQuery("#"+i.conf.domContainerId).bind("apexrefresh",function(){s.start()})}return s}